name: Test Build
on:
  pull_request:
    types: [ assigned, opened, synchronize, reopened ]
  push:
    branches:
      - main

jobs:
  test-build:
    name: Test Build
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Build with Docker
      run: |
        echo "Running test build in Docker..."
        
        docker run --rm \
          -v "$(pwd):/build" \
          -w /build \
          ubuntu:22.04 \
          /bin/bash -c "
            apt-get update && \
            apt-get install -y --no-install-recommends \
              build-essential \
              cmake \
              pkg-config \
              libnm-dev \
              libglib2.0-dev \
              git \               
              ca-certificates \
              && rm -rf /var/lib/apt/lists/* \
            && mkdir -p build && cd build \
            && cmake .. \
            && make -j\$(nproc)"